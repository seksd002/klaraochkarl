@page "/osa"
@inject KlarakarlServices service
<PageTitle>OSA</PageTitle>

<h1>Svara på inbjudan</h1>

<input type="text" placeholder="Ange din e-postadress " @bind="email" />
<br />
<button @onclick="(() => GetValidPersonsAsync(email))">Hitta inbjudan</button>
<div class="row bg-light">
    <table class="table table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Förnamn</th>
                <th>Efternamn</th>
                <th>Email</th>
                <th>Registrerad</th>
                <th>Registrera</th>
            </tr>
        </thead>
        <tbody>
            @if (Persons.Any())
            {
                @foreach (var person in Persons)
                {
                    <tr @onclick="(() => SetPersonForAccept(person))">
                        <td>@person.Surname</td>
                        <td>@person.Lastname</td>
                        <td>@person.Email</td>
                        <td>@person.Registred</td>

                    </tr>
                }
            }
            else
            {
                <tr><td colspan="6"><strong>Hittade inga inbjudningar med vald e-postadress</strong></td></tr>
            }
        </tbody>
    </table>
</div>
@code {
    string? email; 
    List<Person> Persons = new List<Person>();
    private async Task GetValidPersonsAsync(String email)
    {
        Persons = await service.GetValidPersonsAsync(email);
        Console.WriteLine(Persons); 
    }
    private async Task SetPersonForAccept(Person person)
    {
        await service.SetPersonForAccept(person);
    }
    //protected override async Task OnInitializedAsync()
    //{
    //    await RefreshPersons();
    //}
    //private async Task RefreshPersons()
    //{
    //    Persons = await service.GetPersonAsync();
    //}
}

