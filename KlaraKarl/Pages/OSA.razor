@page "/osa"
@inject KlarakarlServices service
<PageTitle>OSA</PageTitle>

<h1>Svara på inbjudan</h1>

@*<input type="text" placeholder="Ange din e-postadress " @bind="email" />
<br />
<button @onclick="(() => GetValidPersonsAsync(email))">Hitta inbjudan</button>*@
<div class="row bg-light">
    @*<table class="table table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Förnamn</th>
                <th>Efternamn</th>
                <th>Email</th>
                <th>Registrerad</th>
                <th>Registrera</th>
            </tr>
        </thead>
        <tbody>
            @if (Persons.Any())
            {
                @foreach (var person in Persons)
                {
                    <tr @onclick="(() => SetPersonForAccept(person))">
                        <td>@person.Surname</td>
                        <td>@person.Lastname</td>
                        <td>@person.Email</td>
                        <td>@person.Registred</td>

                    </tr>
                }
            }
            else
            {
                <tr><td colspan="6"><strong>Hittade inga inbjudningar med vald e-postadress</strong></td></tr>
            }
        </tbody>
    </table>*@
  @*  <EditForm Model="@NewPerson">
        <div class="form-group">
            <label for="surname">Förnamn</label>
            <input type="text"  @bind-Value=NewPerson.SurName id="surname" class="form-control" />
        </div>
        <div class="form-group">
            <label for="price">Efternamn</label>
            <input type="text" id="lastname" class="form-control" />
        </div>
        <div class="form-group">
            <label for="quantity">Email</label>
            <input type="email" id="email" class="form-control"  />
        </div>
       
        <div class="text-center p-3 mb-3">
            <button class="btn btn-info" @onclick="AddNewPerson"> Lägg till person</button>
        </div>
    </EditForm>*@
    <EditForm Model=@NewPerson OnValidSubmit=@ValidFormSubmitted OnInvalidSubmit=@InvalidFormSubmitted>
        <div class="form-group">
            <label for="SurName">Förnamn</label>
            <InputText @bind-Value=NewPerson.Surname class="form-control" id="SurName" />
        </div>
        <div class="form-group">
            <label for="LastName">Förnamn</label>
            <InputText @bind-Value=NewPerson.Lastname class="form-control" id="LastName" />
        </div>
        <div class="form-group">
            <label for="Email">Email</label>
            <InputText @bind-Value=NewPerson.Email class="form-control" id="Email" />
        </div>
        <input type="submit" class="btn btn-primary" value="Skicka" />
    </EditForm>
</div>
@code {
    string? email; 
    List<Person> Persons = new List<Person>();
    private async Task GetValidPersonsAsync(String email)
    {
        Persons = await service.GetValidPersonsAsync(email);
        Console.WriteLine(Persons); 
    }
    private async Task SetPersonForAccept(Person person)
    {
        await service.SetPersonForAccept(person);
    }
    public Person NewPerson { get; set; } = new Person();
    string LastSubmitResult;
    async void ValidFormSubmitted(EditContext editContext)
    {
        NewPerson.Registred = true; 
        await service.AddPersonAsync(NewPerson);
        LastSubmitResult = "OnValidSubmit was executed";
    }

    void InvalidFormSubmitted(EditContext editContext)
    {
        LastSubmitResult = "OnInvalidSubmit was executed";
    }
    //protected override async Task OnInitializedAsync()
    //{
    //    await RefreshPersons();
    //}
    //private async Task RefreshPersons()
    //{
    //    Persons = await service.GetPersonAsync();
    //}
}

